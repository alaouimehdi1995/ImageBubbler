/**
 * Created by mehdi on 11/08/17.
 */
function el(e){return document.getElementById(e)}function checkBoxHandler(e){enableMargin=!!e.checked}function getAverageColor(e,t,l,a,s,r){for(var o,i={R:0,G:0,B:0,number:0},p=t;p<l;p+=r)for(var n=a;n<s;n+=r)o=e.getImageData(p,n,1,1).data,i.R+=o[0],i.G+=o[1],i.B+=o[2],i.number+=1
return i.R=parseInt(i.R/i.number),i.G=parseInt(i.G/i.number),i.B=parseInt(i.B/i.number),i}function split(e,t,l){var a=e.getContext("2d")
console.log("split called")
var s=l.target,r=s.parentNode
r.removeChild(s)
var o,i,p,n,d
o=document.createElement("div"),o.className="bloc",o.style.width=parseFloat(s.style.width)/2+"px",o.style.height=parseFloat(s.style.height)/2+"px",o.style.top=s.style.top,o.style.left=s.style.left,enableMargin&&(o.style.margin=.2*parseFloat(o.style.width)+"px"),d=getAverageColor(a,t*parseFloat(o.style.left),t*(parseFloat(o.style.left)+parseFloat(o.style.width)),t*parseFloat(o.style.top),t*(parseFloat(o.style.top)+parseFloat(o.style.height)),35),o.style.backgroundColor="rgb("+d.R+","+d.G+","+d.B+")",o.addEventListener("mousemove",function(l){split(e,t,l)},!1),i=document.createElement("div"),i.className="bloc",i.style.width=parseFloat(s.style.width)/2+"px",i.style.height=parseFloat(s.style.height)/2+"px",i.style.top=s.style.top,enableMargin&&(i.style.margin=.2*parseFloat(o.style.width)+"px"),i.style.left=parseFloat(s.style.left)+parseFloat(o.style.width)+"px",d=getAverageColor(a,t*parseFloat(i.style.left),t*(parseFloat(i.style.left)+parseFloat(i.style.width)),t*parseFloat(i.style.top),t*(parseFloat(i.style.top)+parseFloat(i.style.height)),35),i.style.backgroundColor="rgb("+d.R+","+d.G+","+d.B+")",i.addEventListener("mousemove",function(l){split(e,t,l)},!1),p=document.createElement("div"),p.className="bloc",p.style.width=parseFloat(s.style.width)/2+"px",p.style.height=parseFloat(s.style.height)/2+"px",p.style.left=s.style.left,enableMargin&&(p.style.margin=.2*parseFloat(o.style.width)+"px"),p.style.top=parseFloat(s.style.top)+parseFloat(o.style.height)+"px",d=getAverageColor(a,t*parseFloat(p.style.left),t*(parseFloat(p.style.left)+parseFloat(p.style.width)),t*parseFloat(p.style.top),t*(parseFloat(p.style.top)+parseFloat(p.style.height)),35),p.style.backgroundColor="rgb("+d.R+","+d.G+","+d.B+")",p.addEventListener("mousemove",function(l){split(e,t,l)},!1),n=document.createElement("div"),n.className="bloc",n.style.width=parseFloat(s.style.width)/2+"px",n.style.height=parseFloat(s.style.height)/2+"px",enableMargin&&(n.style.margin=.2*parseFloat(o.style.width)+"px"),n.style.top=parseFloat(s.style.top)+parseFloat(i.style.height)+"px",n.style.left=parseFloat(s.style.left)+parseFloat(i.style.width)+"px",d=getAverageColor(a,t*parseFloat(n.style.left),t*(parseFloat(n.style.left)+parseFloat(n.style.width)),t*parseFloat(n.style.top),t*(parseFloat(n.style.top)+parseFloat(n.style.height)),35),n.style.backgroundColor="rgb("+d.R+","+d.G+","+d.B+")",n.addEventListener("mousemove",function(l){split(e,t,l)},!1),r.appendChild(o),r.appendChild(i),r.appendChild(p),r.appendChild(n)}function readImage(){var e=document.createElement("div")
if(e.className="resultImage",resultCanvas.parentNode.replaceChild(e,resultCanvas),e.id="colorMap",resultCanvas=e,this.files&&this.files[0]){var t=new FileReader
t.onload=function(e){var t=new Image
t.addEventListener("load",function(){var e=document.createElement("canvas")
e.width=t.width,e.height=t.height
var l=e.getContext("2d")
l.drawImage(t,0,0)
var a=getAverageColor(l,0,e.width,0,e.height,35),s=.7
resultCanvas.style.width=s*parseFloat(screen.width)+"px",resultCanvas.style.height=resultCanvas.style.width,resultCanvas.style.visibility="visible",s=parseFloat(t.width)/parseFloat(resultCanvas.style.width)
var r=document.createElement("div")
r.className="bloc",r.style.width=Math.max(parseFloat(resultCanvas.style.width),parseFloat(resultCanvas.style.height))+"px",r.style.height=parseFloat(r.style.width)+"px",r.style.backgroundColor="rgb("+a.R+","+a.G+","+a.B+")",setMiddle(r,0,resultCanvas.style.width,0,resultCanvas.style.height),resultCanvas.appendChild(r),r.addEventListener("mousemove",function(t){split(e,s,t)},!1)}),t.src=e.target.result},t.readAsDataURL(this.files[0])}}function setMiddle(e,t,l,a,s){e.style.left=parseFloat(l)+parseFloat(t)-parseFloat(e.style.width)+"px",e.style.top=parseFloat(s)+parseFloat(a)-parseFloat(e.style.height)+"px"}var resultCanvas=el("colorMap"),enableMargin=!1,marginProportion=.1
el("fileUpload").addEventListener("change",readImage,!1)
